<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>数学III 学習アプリ</title>
    
    <script>
        MathJax = {
          tex: {
            inlineMath: [['$', '$']]
          },
          chtml: {
            linebreaks: { automatic: true, width: "container" }
          }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" id="MathJax-script"></script>

    <style>
        :root {
            --primary-color: #007bff; --secondary-color: #6f42c1;
            --light-bg: #f0f2f5; --white-bg: #ffffff;
            --text-color: #333; --border-color: #e0e0e0;
            --status-solved: #28a745; --status-attention: #ffc107;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--light-bg); color: var(--text-color);
            margin: 0; padding: 10px;
            display: flex; justify-content: center;
        }
        .app-container {
            width: 100%; max-width: 700px; background: var(--white-bg);
            border-radius: 16px; box-shadow: var(--shadow); overflow: hidden;
            margin: 10px 0 20px;
        }
        header {
            background: linear-gradient(135deg, #0d6efd, #8a63d2); color: white;
            padding: 20px; text-align: center;
        }
        header h1 { margin: 0; font-size: 22px; }
        main { padding: 15px; }
        .control-panel details {
            border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 15px;
        }
        .control-panel summary {
            font-weight: 600; font-size: 15px; padding: 12px 15px; cursor: pointer;
            list-style: none; display: flex; justify-content: space-between; align-items: center;
        }
        .control-panel summary::-webkit-details-marker { display: none; }
        .control-panel summary::after { content: '▼'; font-size: 12px; transition: transform 0.2s; }
        .control-panel details[open] summary::after { transform: rotate(180deg); }
        .filter-content { padding: 0 15px 12px; border-top: 1px solid var(--border-color); }
        .filter-group { display: flex; flex-wrap: wrap; gap: 10px 15px; padding-top: 12px; }
        .filter-group label { display: flex; align-items: center; cursor: pointer; font-size: 14px; }
        .filter-group input { margin-right: 6px; }
        
        #problem-wrapper { margin-top: 20px; }
        .problem-card {
            border: 1px solid var(--border-color); border-radius: 12px; padding: 15px;
            background-color: #fdfdfd;
        }
        .problem-body { font-size: 1.1rem; line-height: 1.8; word-wrap: break-word; overflow-x: auto; }
        
        .status-controls { margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee; display: flex; gap: 10px; }
        .status-btn {
            flex-grow: 1; border: 1px solid var(--border-color); background: #f8f9fa;
            color: #555; padding: 9px; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s;
        }
        .status-btn.active.solved { background-color: var(--status-solved); color: white; border-color: var(--status-solved); }
        .status-btn.active.attention { background-color: var(--status-attention); color: #333; border-color: var(--status-attention); }

        .answer-toggle-btn {
            display: block; width: 100%; margin: 20px 0 15px;
            background-color: var(--secondary-color); color: white; border: none;
            padding: 11px; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer;
        }
        .answer-container {
            background-color: #f7f5fa; border: 1px solid #e9e3f3; border-radius: 8px;
            padding: 15px; display: none;
        }
        .answer-container.visible { display: block; }
        .answer-header { font-weight: 600; color: var(--secondary-color); margin-bottom: 10px; font-size: 15px; }
        .answer-body { line-height: 2.2; font-size: 1.1rem; overflow-x: auto; }
        
        #slider-container { margin: 20px 0; display: none; }
        #problem-slider { width: 100%; cursor: pointer; }

        .navigation { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; }
        .nav-btn {
            background-color: var(--primary-color); color: white; border: none;
            padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;
        }
        .nav-btn:disabled { background-color: #ccc; cursor: not-allowed; }
        #problem-counter { font-size: 15px; color: #555; }
        
        #no-problem-message { text-align: center; padding: 40px 15px; color: #888; border: 1px dashed var(--border-color); border-radius: 12px; margin-top: 20px; }
    </style>
</head>
<body>

<div class="app-container">
    <header><h1>数学III 学習アプリ</h1></header>
    <main>
        <div class="control-panel">
            <details>
                <summary>問題タイプフィルター</summary>
                <div class="filter-content">
                    <div class="filter-group" id="type-filters">
                        <label><input type="checkbox" name="type" value="TRIAL A" checked> A問</label>
                        <label><input type="checkbox" name="type" value="TRIAL B" checked> B問</label>
                        <label><input type="checkbox" name="type" value="例題" checked> 例題</label>
                        <label><input type="checkbox" name="type" value="練習問題" checked> 練習問題</label>
                        <label style="margin-left: auto; color: #c0392b;"><input type="checkbox" id="random-mode"> ランダム</label>
                    </div>
                </div>
            </details>
            <details>
                <summary>進捗フィルター</summary>
                <div class="filter-content">
                   <div class="filter-group" id="status-filters">
                        <label data-status-label="unsolved"><input type="radio" name="status" value="unsolved" checked> 未</label>
                        <label data-status-label="solved"><input type="radio" name="status" value="solved"> 済</label>
                        <label data-status-label="attention"><input type="radio" name="status" value="attention"> 注</label>
                        <label data-status-label="all"><input type="radio" name="status" value="all"> 全</label>
                    </div>
                </div>
            </details>
        </div>

        <div id="problem-wrapper">
            <div class="problem-card">
                <div id="problem-header" class="problem-header"></div>
                <div id="problem-body" class="problem-body"></div>
                <div class="status-controls">
                    <button class="status-btn" data-status="solved">クリア！</button>
                    <button class="status-btn" data-status="attention">要復習</button>
                    <button class="status-btn" data-status="unsolved">未設定に戻す</button>
                </div>
            </div>
            
            <button id="answer-toggle-btn" class="answer-toggle-btn">解答を表示</button>

            <div id="answer-container" class="answer-container">
                <div id="answer-header" class="answer-header"></div>
                <div id="answer-body" class="answer-body"></div>
            </div>

            <div id="slider-container">
                <input type="range" id="problem-slider">
            </div>

            <div class="navigation">
                <button id="prev-btn" class="nav-btn">前の問題</button>
                <span id="problem-counter"></span>
                <button id="next-btn" class="nav-btn">次の問題</button>
            </div>
        </div>

        <div id="no-problem-message" style="display: none;">
            <p>フィルター条件に一致する問題がありません。<br>フィルターのチェックを確認してください。</p>
        </div>
    </main>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // 問題データ
    const problems = [
        // P28-30
        { id: 'p28-n95-s1', page: 28, type: 'TRIAL A', number: 95, sub: 1, question: '次の極限を求めよ。<br>$$\\lim_{x \\to \\frac{\\pi}{2}} \\frac{1}{\\sin x}$$', answer: '$$ \\lim_{x \\to \\frac{\\pi}{2}} \\frac{1}{\\sin x} = \\frac{1}{\\sin \\frac{\\pi}{2}} = \\frac{1}{1} = 1 $$' },
        { id: 'p28-n95-s2', page: 28, type: 'TRIAL A', number: 95, sub: 2, question: '次の極限を求めよ。<br>$$\\lim_{x \\to \\infty} \\cos \\frac{1}{x}$$', answer: '$$ t = \\frac{1}{x} とおくと、x \\to \\infty のとき t \\to 0。 \\\\ よって、\\lim_{t \\to 0} \\cos t = \\cos 0 = 1 $$' },
        { id: 'p28-n95-s3', page: 28, type: 'TRIAL A', number: 95, sub: 3, question: '次の極限を求めよ。<br>$$\\lim_{x \\to \\frac{\\pi}{2}} \\tan x$$', answer: '$$ x \\to \\frac{\\pi}{2}-0 のとき \\tan x \\to \\infty \\\\ x \\to \\frac{\\pi}{2}+0 のとき \\tan x \\to -\\infty \\\\ \\text{したがって、極限はない。}$$' },
        { id: 'p28-n96-s1', page: 28, type: 'TRIAL A', number: 96, sub: 1, question: '次の極限を求めよ。<br>$$\\lim_{x \\to 0} \\frac{\\sin 4x}{x}$$', answer: '$$ \\lim_{x \\to 0} \\frac{\\sin 4x}{4x} \\cdot 4 = 1 \\cdot 4 = 4 $$' },
        { id: 'p28-n96-s2', page: 28, type: 'TRIAL A', number: 96, sub: 2, question: '次の極限を求めよ。<br>$$\\lim_{x \\to 0} \\frac{x}{\\sin 2x}$$', answer: '$$ \\lim_{x \\to 0} \\frac{1}{\\frac{\\sin 2x}{2x}} \\cdot \\frac{1}{2} = 1 \\cdot \\frac{1}{2} = \\frac{1}{2} $$' },
        { id: 'p28-n96-s3', page: 28, type: 'TRIAL A', number: 96, sub: 3, question: '次の極限を求めよ。<br>$$\\lim_{x \\to 0} \\frac{\\sin 2x}{\\sin 4x}$$', answer: '$$ \\lim_{x \\to 0} \\frac{\\frac{\\sin 2x}{2x} \\cdot 2x}{\\frac{\\sin 4x}{4x} \\cdot 4x} = \\lim_{x \\to 0} \\frac{1 \\cdot 2x}{1 \\cdot 4x} \\\\ = \\frac{2}{4} = \\frac{1}{2} $$' },
        { id: 'p28-n96-s4', page: 28, type: 'TRIAL A', number: 96, sub: 4, question: '次の極限を求めよ。<br>$$\\lim_{x \\to 0} \\frac{\\sin 3x}{\\tan x}$$', answer: '$$ \\lim_{x \\to 0} \\frac{\\sin 3x}{\\frac{\\sin x}{\\cos x}} = \\lim_{x \\to 0} \\frac{\\sin 3x}{\\sin x} \\cos x \\\\ = \\lim_{x \\to 0} \\frac{\\frac{\\sin 3x}{3x} \\cdot 3x}{\\frac{\\sin x}{x} \\cdot x} \\cos x \\\\ = \\lim_{x \\to 0} 3 \\cos x = 3 \\cos 0 = 3 $$' },
        { id: 'p28-n97-s1', page: 28, type: 'TRIAL B', number: 97, sub: 1, question: '次の極限を求めよ。<br>$$\\lim_{x \\to 0} x^2 \\cos \\frac{1}{x}$$', answer: '$$ -1 \\le \\cos \\frac{1}{x} \\le 1 \\text{ であり、} \\\\ \\text{各辺に } x^2 (\\ge 0) \\text{ をかけると、} \\\\ -x^2 \\le x^2 \\cos \\frac{1}{x} \\le x^2 \\\\ \\text{ここで、} \\lim_{x \\to 0} (-x^2) = 0, \\lim_{x \\to 0} x^2 = 0 \\text{ なので、} \\\\ \\text{はさみうちの原理より、} \\lim_{x \\to 0} x^2 \\cos \\frac{1}{x} = 0 $$' },
        { id: 'p28-n97-s2', page: 28, type: 'TRIAL B', number: 97, sub: 2, question: '次の極限を求めよ。<br>$$\\lim_{x \\to \\infty} \\frac{\\sin x}{x}$$', answer: '$$ -1 \\le \\sin x \\le 1 \\text{ であり、} x>0 \\text{ のとき、} \\\\ -\\frac{1}{x} \\le \\frac{\\sin x}{x} \\le \\frac{1}{x} \\\\ \\text{ここで、} \\lim_{x \\to \\infty} (-\\frac{1}{x}) = 0, \\lim_{x \\to \\infty} \\frac{1}{x} = 0 \\text{ なので、} \\\\ \\text{はさみうちの原理より、} \\lim_{x \\to \\infty} \\frac{\\sin x}{x} = 0 $$' },
        { id: 'p28-n98-s1', page: 28, type: 'TRIAL B', number: 98, sub: 1, question: '次の極限を求めよ。<br>$$\\lim_{x \\to 0} \\frac{\\sin^2 x}{1 - \\cos x}$$', answer: '$$ \\lim_{x \\to 0} \\frac{1 - \\cos^2 x}{1 - \\cos x} \\\\ = \\lim_{x \\to 0} \\frac{(1 - \\cos x)(1 + \\cos x)}{1 - \\cos x} \\\\ = \\lim_{x \\to 0} (1 + \\cos x) = 1 + \\cos 0 = 2 $$' },
        { id: 'p28-n98-s2', page: 28, type: 'TRIAL B', number: 98, sub: 2, question: '次の極限を求めよ。<br>$$\\lim_{x \\to 0} \\frac{1 - \\cos 2x}{x^2}$$', answer: '$$ \\lim_{x \\to 0} \\frac{2\\sin^2 x}{x^2} = \\lim_{x \\to 0} 2 \\left(\\frac{\\sin x}{x}\\right)^2 \\\\ = 2 \\cdot 1^2 = 2 $$' },
        { id: 'p28-n98-s3', page: 28, type: 'TRIAL B', number: 98, sub: 3, question: '次の極限を求めよ。<br>$$\\lim_{x \\to 0} \\frac{x \\sin 2x}{1 - \\cos x}$$', answer: '$$ \\lim_{x \\to 0} \\frac{x \\sin 2x(1 + \\cos x)}{1 - \\cos^2 x} \\\\ = \\lim_{x \\to 0} \\frac{x (2\\sin x \\cos x)(1 + \\cos x)}{\\sin^2 x} \\\\ = \\lim_{x \\to 0} \\frac{2x \\cos x(1+\\cos x)}{\\sin x} \\\\ = \\lim_{x \\to 0} 2 \\cdot \\frac{x}{\\sin x} \\cdot \\cos x (1+\\cos x) \\\\ = 2 \\cdot 1 \\cdot 1 \\cdot (1+1) = 4 $$' },
        { id: 'p28-n99-s1', page: 28, type: 'TRIAL B', number: 99, sub: 1, question: '次の極限を求めよ。<br>$$\\lim_{x \\to 0} \\frac{\\tan x^\\circ}{x}$$', answer: '$$ x^\\circ = x \\cdot \\frac{\\pi}{180} \\text{ ラジアンなので、} \\\\ \\lim_{x \\to 0} \\frac{\\tan(\\frac{\\pi}{180}x)}{x} \\\\ = \\lim_{x \\to 0} \\frac{\\tan(\\frac{\\pi}{180}x)}{\\frac{\\pi}{180}x} \\cdot \\frac{\\pi}{180} \\\\ = 1 \\cdot \\frac{\\pi}{180} = \\frac{\\pi}{180} $$' },
        { id: 'p28-n99-s2', page: 28, type: 'TRIAL B', number: 99, sub: 2, question: '次の極限を求めよ。<br>$$\\lim_{x \\to 0} \\frac{\\sin(\\sin x)}{\\sin x}$$', answer: '$$ t = \\sin x とおくと、x \\to 0 のとき t \\to 0。 \\\\ よって、\\lim_{t \\to 0} \\frac{\\sin t}{t} = 1 $$' },
        { id: 'p28-n99-s3', page: 28, type: 'TRIAL B', number: 99, sub: 3, question: '次の極限を求めよ。<br>$$\\lim_{x \\to 0} \\frac{3x + \\sin x}{\\sin 2x}$$', answer: '$$ \\text{分子分母をxで割ると、} \\\\ \\lim_{x \\to 0} \\frac{3 + \\frac{\\sin x}{x}}{\\frac{\\sin 2x}{x}} = \\lim_{x \\to 0} \\frac{3 + \\frac{\\sin x}{x}}{\\frac{\\sin 2x}{2x} \\cdot 2} \\\\ = \\frac{3 + 1}{1 \\cdot 2} = \\frac{4}{2} = 2 $$' },
        { id: 'p29-n100-s1', page: 29, type: 'TRIAL B', number: 100, sub: 1, question: '次の極限を求めよ。<br>$$\\lim_{x \\to \\infty} x \\sin \\frac{1}{x}$$', answer: '$$ t = \\frac{1}{x} とおくと、x \\to \\infty のとき t \\to +0。\\\\ \\lim_{t \\to +0} \\frac{1}{t} \\sin t = \\lim_{t \\to +0} \\frac{\\sin t}{t} = 1 $$' },
        { id: 'p29-n100-s2', page: 29, type: 'TRIAL B', number: 100, sub: 2, question: '次の極限を求めよ。<br>$$\\lim_{x \\to \\infty} 2x \\sin \\frac{1}{x}$$', answer: '$$ t = \\frac{1}{x} とおくと、x \\to \\infty のとき t \\to +0。\\\\ \\lim_{t \\to +0} 2 \\frac{\\sin t}{t} = 2 \\cdot 1 = 2 $$' },
        { id: 'p29-n100-s3', page: 29, type: 'TRIAL B', number: 100, sub: 3, question: '次の極限を求めよ。<br>$$\\lim_{x \\to \\pi} \\frac{\\sin(x-\\pi)}{x-\\pi}$$', answer: '$$ t = x-\\pi とおくと、x \\to \\pi のとき t \\to 0。\\\\ \\lim_{t \\to 0} \\frac{\\sin t}{t} = 1 $$' },
        { id: 'p29-n100-s4', page: 29, type: 'TRIAL B', number: 100, sub: 4, question: '次の極限を求めよ。<br>$$\\lim_{x \\to 1} \\frac{\\sin \\pi x}{x-1}$$', answer: '$$ t = x-1 とおくと、x=t+1。x \\to 1 のとき t \\to 0。\\\\ \\lim_{t \\to 0} \\frac{\\sin \\pi(t+1)}{t} = \\lim_{t \\to 0} \\frac{\\sin(\\pi t + \\pi)}{t} \\\\ = \\lim_{t \\to 0} \\frac{-\\sin \\pi t}{t} = \\lim_{t \\to 0} -\\frac{\\sin \\pi t}{\\pi t} \\cdot \\pi \\\\ = -1 \\cdot \\pi = -\\pi $$' },
        { id: 'p29-n9', page: 29, type: '例題', number: 9, sub: null, question: '半径1の円Oの周上に中心角 $2\\theta$ の弧ABをとり、弧ABを2等分する点をCとする。線分OCと弦ABの交点をDとするとき、極限 $\\displaystyle \\lim_{\\theta \\to +0} \\frac{\\text{CD}}{\\text{AB}^2}$ を求めよ。', answer: '$$ \\angle AOD = \\theta, CD = 1 - \\cos\\theta, AB = 2\\sin\\theta \\\\ \\lim_{\\theta \\to +0} \\frac{CD}{AB^2} = \\lim_{\\theta \\to +0} \\frac{1-\\cos\\theta}{(2\\sin\\theta)^2} \\\\ = \\lim_{\\theta \\to +0} \\frac{1-\\cos\\theta}{4(1-\\cos^2\\theta)} \\\\ = \\lim_{\\theta \\to +0} \\frac{1}{4(1+\\cos\\theta)} = \\frac{1}{8} $$' },
        { id: 'p29-n101-s1', page: 29, type: 'TRIAL B', number: 101, sub: 1, question: '半径rの円O上に定点Aと動点Pがあり、$\\angle POA=\\theta$ ($0<\\theta<\\pi/2$)とする。PからOAに下ろした垂線をPHとするとき、AH, PH, APを$\\theta$で表せ。', answer: '$$ PH = r\\sin\\theta \\\\ AH = r(1-\\cos\\theta) \\\\ AP^2 = AH^2+PH^2 \\\\ = r^2(1-2\\cos\\theta+\\cos^2\\theta + \\sin^2\\theta) \\\\ = 2r^2(1-\\cos\\theta) \\\\ AP = \\sqrt{2r^2(1-\\cos\\theta)} = 2r\\sin(\\theta/2) $$' },
        { id: 'p29-n101-s2', page: 29, type: 'TRIAL B', number: 101, sub: 2, question: '問101(1)の設定で、極限 $\\displaystyle \\lim_{\\theta \\to +0} \\frac{\\text{AP}^2}{\\text{AH}}$ を求めよ。', answer: '$$ \\text{（解答集の答え(2r)から、問題はAP²/AHと判断）} \\\\ \\lim_{\\theta \\to +0} \\frac{AP^2}{AH} = \\lim_{\\theta \\to +0} \\frac{2r^2(1-\\cos\\theta)}{r(1-\\cos\\theta)} \\\\ = \\lim_{\\theta \\to +0} 2r = 2r $$' },
        { id: 'p30-n102-s1', page: 30, type: 'TRIAL A', number: 102, sub: 1, question: '関数 $f(x)=x^2+2x$ は $x=0$ で連続か。', answer: '$$ \\lim_{x \\to 0} f(x) = 0, f(0) = 0 \\\\ \\lim_{x \\to 0} f(x) = f(0) \\text{が成り立つので、連続である。}$$' },
        { id: 'p30-n102-s2', page: 30, type: 'TRIAL A', number: 102, sub: 2, question: '関数 $f(x)=\\frac{|x|}{x}$ は $x=-1$ で連続か。', answer: '$$ \\lim_{x \\to -1} f(x) = -1, f(-1) = -1 \\\\ \\lim_{x \\to -1} f(x) = f(-1) \\text{が成り立つので、連続である。}$$' },
        { id: 'p30-n102-s3', page: 30, type: 'TRIAL A', number: 102, sub: 3, question: '関数 $f(x)=[x]$ は $x=0$ で連続か。', answer: '$$ \\lim_{x \\to +0} [x] = 0 \\\\ \\lim_{x \\to -0} [x] = -1 \\\\ \\text{左右の極限が異なるため、不連続である。}$$' },
        { id: 'p30-n102-s4', page: 30, type: 'TRIAL A', number: 102, sub: 4, question: '関数 $f(x)=[\sin x]$ は $x=\\frac{\\pi}{2}$ で連続か。', answer: '$$ \\lim_{x \\to \\frac{\\pi}{2}} [\\sin x] = 0 \\\\ (\\text{なぜなら} x \\neq \\pi/2 \\text{のとき} \\sin x < 1 \\text{だから)} \\\\ f(\\frac{\\pi}{2}) = [\\sin \\frac{\\pi}{2}] = [1] = 1 \\\\ \\text{極限値と関数値が異なるため、不連続である。}$$' },
        { id: 'p30-n103-s1', page: 30, type: 'TRIAL A', number: 103, sub: 1, question: '関数 $f(x) = \\frac{1}{x}$ が連続である区間を求めよ。', answer: '$$ x=0 で定義されない。\\\\ \\text{連続な区間は } (-\\infty, 0), (0, \\infty) $$' },
        { id: 'p30-n103-s2', page: 30, type: 'TRIAL A', number: 103, sub: 2, question: '関数 $f(x) = \\frac{x+2}{x^2-x+1}$ が連続である区間を求めよ。', answer: '$$ \\text{分母 } x^2-x+1 \\text{ の判別式 } D < 0。\\\\ \\text{分母は常に正で、0にならない。}\\\\ \\text{よって、すべての実数で連続。区間は } (-\\infty, \\infty) $$' },
        { id: 'p30-n103-s3', page: 30, type: 'TRIAL A', number: 103, sub: 3, question: '関数 $f(x) = \\sqrt{x^2-x-6}$ が連続である区間を求めよ。', answer: '$$ x^2-x-6 \\ge 0 \\implies (x-3)(x+2) \\ge 0 \\\\ \\text{よって } x \\le -2, x \\ge 3。\\\\ \\text{連続な区間は } (-\\infty, -2], [3, \\infty) $$' },
        { id: 'p30-n104-s1', page: 30, type: 'TRIAL A', number: 104, sub: 1, question: '$f(x)=|3x-2|$ の区間 $[0, 1]$ での最大値・最小値を調べよ。', answer: '$$ \\text{最小値は } x=2/3 \\text{ のとき } f(2/3)=0。\\\\ \\text{区間の端の値は } f(0)=2, f(1)=1。\\\\ \\text{よって、最大値 2, 最小値 0。}$$' },
        { id: 'p30-n104-s2', page: 30, type: 'TRIAL A', number: 104, sub: 2, question: '$f(x)=2^{1-x}$ の区間 $[0, 1]$ での最大値・最小値を調べよ。', answer: '$$ f(x) \\text{ は単調減少関数。}\\\\ \\text{最大値: } f(0) = 2^{1-0} = 2 \\\\ \\text{最小値: } f(1) = 2^{1-1} = 1 $$' },
        
        // P31 (Corrected data)
        { id: 'p31-n105-s1', page: 31, type: 'TRIAL A', number: 105, sub: 1, question: '次の方程式は、与えられた範囲に少なくとも1つの実数解をもつことを示せ。<br>$$ x - {\\left(\\frac{1}{3}\\right)}^x = 0 \\quad (0 \\lt x \\lt 1) $$', answer: '$f(x) = x - {\\left(\\frac{1}{3}\\right)}^x$ とおく。$f(x)$は区間$[0, 1]$で連続である。<br>$$ f(0) = 0 - 1 = -1 < 0 $$ $$ f(1) = 1 - \\frac{1}{3} = \\frac{2}{3} > 0 $$ $f(0)$と$f(1)$の符号が異なるため、中間値の定理により、$0 \\lt x \\lt 1$の範囲に少なくとも1つの実数解をもつ。'},
        { id: 'p31-n105-s2', page: 31, type: 'TRIAL A', number: 105, sub: 2, question: '次の方程式は、与えられた範囲に少なくとも1つの実数解をもつことを示せ。<br>$$ \\log_{10}{x} - \\frac{x}{20} = 0 \\quad (10 \\lt x \\lt 100) $$', answer: '$f(x) = \\log_{10}{x} - \\frac{x}{20}$ とおく。$f(x)$は区間$[10, 100]$で連続である。<br>$$ f(10) = \\log_{10}{10} - \\frac{10}{20} = 0.5 > 0 $$ $$ f(100) = \\log_{10}{100} - \\frac{100}{20} = -3 < 0 $$ $f(10)$と$f(100)$の符号が異なるため、中間値の定理により、$10 \\lt x \\lt 100$の範囲に少なくとも1つの実数解をもつ。'},
        { id: 'p31-n106', page: 31, type: 'TRIAL B', number: 106, sub: null, question: '次の関数$f(x)$が $x=0$ で連続であるように、定数$a$の値を定めよ。<br>$$ f(x) = \\begin{cases} \\frac{\\cos x-1}{x^2} & (x \\neq 0) \\\\ a & (x=0) \\end{cases} $$', answer: '$$ x=0 で連続であるには、\\lim_{x \\to 0} f(x) = f(0) となればよい。\\\\ \\lim_{x \\to 0} \\frac{\\cos x - 1}{x^2} = \\lim_{x \\to 0} \\frac{(\\cos x - 1)(\\cos x + 1)}{x^2(\\cos x + 1)} \\\\ = \\lim_{x \\to 0} \\frac{-\\sin^2 x}{x^2(\\cos x + 1)} = \\lim_{x \\to 0} -\\left(\\frac{\\sin x}{x}\\right)^2 \\frac{1}{\\cos x + 1} \\\\ = -1^2 \\cdot \\frac{1}{1+1} = -\\frac{1}{2} \\\\ f(0)=a なので、a = -\\frac{1}{2} $$'},
        { id: 'p31-n10', page: 31, type: '例題', number: 10, sub: null, question: '関数 $f(x)=\\lim_{n \\to \\infty} \\frac{x^{2n+1}}{1+x^{2n}}$ のグラフをかけ。', answer: '$$ [1] |x|<1 のとき \\\\ \\lim x^{2n} = 0, \\lim x^{2n+1} = 0 \\implies f(x)=0 \\\\ [2] x=1 のとき \\implies f(1) = \\frac{1}{2} \\\\ [3] x=-1 のとき \\implies f(-1) = -\\frac{1}{2} \\\\ [4] |x|>1 のとき、分母分子をx^{2n}で割ると \\\\ f(x) = \\lim_{n \\to \\infty} \\frac{x}{\\frac{1}{x^{2n}}+1} = x \\\\ \\text{グラフは解答図の通り。} x= \\pm 1で不連続。 $$'},
        { id: 'p31-n107-s1', page: 31, type: 'TRIAL B', number: 107, sub: 1, question: '関数 $f(x)=\\lim_{n \\to \\infty} \\frac{1+x}{1+x^{2n}}$ のグラフをかけ。', answer: '$$ 1+x^{2n}>0 なので定義域は全ての実数。\\\\ [1] |x|<1のとき、x^{2n} \\to 0 なので f(x)=1+x \\\\ [2] x=1のとき、f(1)=2/2=1 \\\\ [3] x=-1のとき、f(-1)=0/2=0 \\\\ [4] |x|>1のとき、x^{2n} \\to \\infty なので f(x)=0 \\\\ \\text{グラフを描くと、x=1, x=-1で不連続。} $$'},
        { id: 'p31-n107-s2', page: 31, type: 'TRIAL B', number: 107, sub: 2, question: '関数 $f(x)=\\lim_{n \\to \\infty} \\sin^n x \\quad (0 \\le x \\le 2\\pi)$ のグラフをかけ。', answer: '$$ [1] \\sin x = 1 \\iff x=\\pi/2 のとき、f(x)=1 \\\\ [2] \\sin x = -1 \\iff x=3\\pi/2 のとき、極限は振動し存在しない。\\\\ [3] |\\sin x| < 1 \\iff x \\neq \\pi/2, 3\\pi/2 のとき、f(x)=0 \\\\ \\text{よって、} x=3\\pi/2 \\text{で定義されず、} x=\\pi/2 \\text{で不連続。} $$'},
        { id: 'p31-n108', page: 31, type: 'TRIAL B', number: 108, sub: null, question: '方程式 $x^3 - 3x^2 + 2x - 1 = 0$ は正の解をもつことを示せ。', answer: '$f(x) = x^3 - 3x^2 + 2x - 1$ とおく。$f(x)$は連続な関数である。<br>$$ f(2) = 8 - 12 + 4 - 1 = -1 < 0 $$ $$ f(3) = 27 - 27 + 6 - 1 = 5 > 0 $$ $f(2)$と$f(3)$の符号が異なるため、中間値の定理により、$2 \\lt x \\lt 3$の範囲に解をもつ。これは正の解である。'},
        { id: 'p31-n109', page: 31, type: 'TRIAL B', number: 109, sub: null, question: '関数 $f(x)$ が実数全体で連続で、$f(0)=-1, f(1)=2, f(2)=3, f(3)=10$ のとき、方程式 $f(x)=x^2$ は $0 \\lt x \\lt 3$ の範囲に少なくとも3個の異なる実数解をもつことを示せ。', answer: '$g(x)=f(x)-x^2$ とおくと、$g(x)$は連続。$$ g(0)=f(0)-0^2 = -1 < 0 $$$$ g(1)=f(1)-1^2 = 1 > 0 $$$$ g(2)=f(2)-2^2 = -1 < 0 $$$$ g(3)=f(3)-3^2 = 1 > 0 $$ $g(x)$の符号が$(0,1), (1,2), (2,3)$の各区間の両端で異なるため、中間値の定理により、それぞれの区間に少なくとも1つずつ解が存在する。よって合計3個以上の解をもつ。'},
        
        // P32
        { id: 'p32-n11', page: 32, type: '例題', number: 11, sub: null, question: '次の等式が成り立つように、定数 $a, b$ の値を定めよ。<br>$$ \\lim_{x \\to \\infty} (\\sqrt{x^2+ax} + bx) = 4 $$', answer: '$$ b>0 なら\\infty, b=0なら\\inftyに発散するため、b<0。\\\\ \\lim_{x \\to \\infty} \\frac{(x^2+ax) - b^2x^2}{\\sqrt{x^2+ax}-bx} = \\lim_{x \\to \\infty} \\frac{(1-b^2)x^2+ax}{\\sqrt{x^2+ax}-bx} \\\\ \\text{収束するには分子の最高次が分母と同じ1次である必要があるので、} \\\\ 1-b^2=0 \\implies b=-1 \\quad (\\because b<0) \\\\ \\text{このとき、極限は} \\\\ \\lim_{x \\to \\infty} \\frac{ax}{\\sqrt{x^2+ax}+x} = \\lim_{x \\to \\infty} \\frac{a}{\\sqrt{1+a/x}+1} = \\frac{a}{2} \\\\ \\frac{a}{2}=4 より a=8。\\\\ \\therefore a=8, b=-1 $$' },
        { id: 'p32-n110', page: 32, type: '練習問題', number: 110, sub: null, question: '次の等式が成り立つように、定数 $a, b$ の値を定めよ。<br>$$ \\lim_{x \\to \\infty} (\\sqrt{x^2-1}+ax+b) = 0 $$', answer: '$$ a>0, a=0では\\inftyに発散するため、a<0。\\\\ \\text{収束するには、不定形 } \\infty - \\infty \\text{ を作る必要があるため} \\\\ a=-1 \\text{ が必要。} \\\\ \\lim_{x \\to \\infty} ((\\sqrt{x^2-1}-x)+b) \\\\ = \\lim_{x \\to \\infty} (\\frac{x^2-1-x^2}{\\sqrt{x^2-1}+x} + b) \\\\ = \\lim_{x \\to \\infty} (\\frac{-1}{\\sqrt{x^2-1}+x} + b) = 0+b \\\\ \\text{よって } b=0。\\\\ \\therefore a=-1, b=0 $$' },
        
        // P33
        { id: 'p33-n111-s1', page: 33, type: 'TRIAL A', number: 111, sub: 1, question: '微分係数の定義に従って求めよ。<br>$$ f(x)=\\sqrt{2x} \\quad (x=1) $$', answer: '$$ f\'(1) = \\lim_{h \\to 0} \\frac{\\sqrt{2(1+h)} - \\sqrt{2}}{h} \\\\ = \\lim_{h \\to 0} \\frac{2(1+h) - 2}{h(\\sqrt{2+2h} + \\sqrt{2})} \\\\ = \\lim_{h \\to 0} \\frac{2h}{h(\\sqrt{2+2h} + \\sqrt{2})} \\\\ = \\frac{2}{2\\sqrt{2}} = \\frac{1}{\\sqrt{2}} $$' },
        { id: 'p33-n111-s2', page: 33, type: 'TRIAL A', number: 111, sub: 2, question: '微分係数の定義に従って求めよ。<br>$$ f(x)=\\frac{1}{x} \\quad (x=3) $$', answer: '$$ f\'(3) = \\lim_{h \\to 0} \\frac{\\frac{1}{3+h} - \\frac{1}{3}}{h} \\\\ = \\lim_{h \\to 0} \\frac{1}{h} \\left( \\frac{3 - (3+h)}{3(3+h)} \\right) \\\\ = \\lim_{h \\to 0} \\frac{-h}{h \\cdot 3(3+h)} = -\\frac{1}{9} $$' },

        // P34
        { id: 'p34-n112-s1', page: 34, type: 'TRIAL A', number: 112, sub: 1, question: '次の関数は $x=1$ で微分可能か調べよ。<br>$$ f(x)=|(x-1)^3| $$', answer: '$$ f(x) = (x-1)^3 \\quad (x \\ge 1) \\\\ f(x) = -(x-1)^3 \\quad (x < 1) \\\\ \\lim_{h \\to +0} \\frac{f(1+h)-f(1)}{h} = \\lim_{h \\to +0} \\frac{h^3-0}{h} = 0 \\\\ \\lim_{h \\to -0} \\frac{f(1+h)-f(1)}{h} = \\lim_{h \\to -0} \\frac{-h^3-0}{h} = 0 \\\\ \\text{左右の極限が一致するので、微分可能である。} $$' },
        { id: 'p34-n112-s2', page: 34, type: 'TRIAL A', number: 112, sub: 2, question: '次の関数は $x=0$ で微分可能か調べよ。<br>$$ f(x)=x[x] $$', answer: '$$ \\lim_{h \\to +0} \\frac{f(h)-f(0)}{h} = \\lim_{h \\to +0} \\frac{h[h]-0}{h} = \\lim_{h \\to +0} [h] = 0 \\\\ \\lim_{h \\to -0} \\frac{f(h)-f(0)}{h} = \\lim_{h \\to -0} \\frac{h[h]-0}{h} = \\lim_{h \\to -0} [h] = -1 \\\\ \\text{左右の極限が一致しないので、微分可能でない。} $$' },
        { id: 'p34-n113-s1', page: 34, type: 'TRIAL A', number: 113, sub: 1, question: '導関数の定義に従って求めよ。<br>$$ f(x)=\\frac{1}{x-2} $$', answer: '$$ f\'(x) = \\lim_{h \\to 0} \\frac{\\frac{1}{x+h-2} - \\frac{1}{x-2}}{h} \\\\ = \\lim_{h \\to 0} \\frac{1}{h} \\frac{(x-2)-(x+h-2)}{(x+h-2)(x-2)} \\\\ = \\lim_{h \\to 0} \\frac{-h}{h(x+h-2)(x-2)} = -\\frac{1}{(x-2)^2} $$' },
        { id: 'p34-n113-s2', page: 34, type: 'TRIAL A', number: 113, sub: 2, question: '導関数の定義に従って求めよ。<br>$$ f(x)=\\frac{1}{x^2} $$', answer: '$$ f\'(x) = \\lim_{h \\to 0} \\frac{\\frac{1}{(x+h)^2} - \\frac{1}{x^2}}{h} \\\\ = \\lim_{h \\to 0} \\frac{1}{h} \\frac{x^2-(x+h)^2}{x^2(x+h)^2} \\\\ = \\lim_{h \\to 0} \\frac{-2xh-h^2}{h x^2(x+h)^2} = -\\frac{2}{x^3} $$' },
        { id: 'p34-n113-s3', page: 34, type: 'TRIAL A', number: 113, sub: 3, question: '導関数の定義に従って求めよ。<br>$$ f(x)=\\sqrt{2x+1} $$', answer: '$$ f\'(x) = \\lim_{h \\to 0} \\frac{\\sqrt{2x+2h+1}-\\sqrt{2x+1}}{h} \\\\ = \\lim_{h \\to 0} \\frac{2h}{h(\\sqrt{2x+2h+1}+\\sqrt{2x+1})} \\\\ = \\frac{1}{\\sqrt{2x+1}} $$' },
        { id: 'p34-n114-s1', page: 34, type: 'TRIAL A', number: 114, sub: 1, question: '次の関数を微分せよ。<br>$$y = -x^3+5x^2+4$$', answer: '$$ y\' = -3x^2+10x $$' },
        { id: 'p34-n114-s2', page: 34, type: 'TRIAL A', number: 114, sub: 2, question: '次の関数を微分せよ。<br>$$y = 2x^7-6x^2+x$$', answer: '$$ y\' = 14x^6-12x+1 $$' },
        { id: 'p34-n114-s3', page: 34, type: 'TRIAL A', number: 114, sub: 3, question: '次の関数を微分せよ。<br>$$y = (x^2+1)(2x^2-3)$$', answer: '$$ y\' = (2x)(2x^2-3) + (x^2+1)(4x) \\\\ = 8x^3-2x $$' },
        { id: 'p34-n114-s4', page: 34, type: 'TRIAL A', number: 114, sub: 4, question: '次の関数を微分せよ。<br>$$y = (2x^2-5x)^2$$', answer: '$$ y = 4x^4-20x^3+25x^2 \\\\ y\' = 16x^3-60x^2+50x $$' },
        { id: 'p34-n114-s5', page: 34, type: 'TRIAL A', number: 114, sub: 5, question: '次の関数を微分せよ。<br>$$y = (3x^2+2)(x^2-4x+5)$$', answer: '$$ y\' = (6x)(x^2-4x+5) + (3x^2+2)(2x-4) \\\\ = 12x^3-36x^2+34x-8 $$' },
        { id: 'p34-n115-s1', page: 34, type: 'TRIAL A', number: 115, sub: 1, question: '次の関数を微分せよ。<br>$$y=\\frac{1}{x+1}$$', answer: '$$ y\' = -\\frac{1}{(x+1)^2} $$' },
        { id: 'p34-n115-s2', page: 34, type: 'TRIAL A', number: 115, sub: 2, question: '次の関数を微分せよ。<br>$$y=\\frac{1}{x^2-1}$$', answer: '$$ y\' = -\\frac{2x}{(x^2-1)^2} $$' },
        { id: 'p34-n115-s3', page: 34, type: 'TRIAL A', number: 115, sub: 3, question: '次の関数を微分せよ。<br>$$y=\\frac{2x}{x+3}$$', answer: '$$ y\' = \\frac{6}{(x+3)^2} $$' },
        { id: 'p34-n115-s4', page: 34, type: 'TRIAL A', number: 115, sub: 4, question: '次の関数を微分せよ。<br>$$y=\\frac{x-1}{x^2+1}$$', answer: '$$ y\' = \\frac{-x^2+2x+1}{(x^2+1)^2} $$' },
        { id: 'p34-n115-s5', page: 34, type: 'TRIAL A', number: 115, sub: 5, question: '次の関数を微分せよ。<br>$$y=\\frac{x}{x^2-x+1}$$', answer: '$$ y\' = \\frac{-x^2+1}{(x^2-x+1)^2} $$' },
        { id: 'p34-n115-s6', page: 34, type: 'TRIAL A', number: 115, sub: 6, question: '次の関数を微分せよ。<br>$$y=\\frac{x^2-4x+1}{x-2}$$', answer: '$$ y\' = \\frac{x^2-4x+7}{(x-2)^2} $$' },
        { id: 'p34-n116-s1', page: 34, type: 'TRIAL A', number: 116, sub: 1, question: '次の関数を微分せよ。<br>$$y=\\frac{1}{2x^4}$$', answer: '$$ y\' = -\\frac{2}{x^5} $$' },
        { id: 'p34-n116-s2', page: 34, type: 'TRIAL A', number: 116, sub: 2, question: '次の関数を微分せよ。<br>$$y=-\\frac{1}{x}+\\frac{3}{x^2}$$', answer: '$$ y\' = \\frac{1}{x^2} - \\frac{6}{x^3} $$' },
        { id: 'p34-n116-s3', page: 34, type: 'TRIAL A', number: 116, sub: 3, question: '次の関数を微分せよ。<br>$$y=\\frac{x^3+x+1}{x^2}$$', answer: '$$ y\' = 1 - \\frac{1}{x^2} - \\frac{2}{x^3} $$' },
        { id: 'p34-n117-s1', page: 34, type: 'TRIAL A', number: 117, sub: 1, question: '次の関数を微分せよ。<br>$$y=(x-1)^2$$', answer: '$$ y\' = 2(x-1) $$' },
        { id: 'p34-n117-s2', page: 34, type: 'TRIAL A', number: 117, sub: 2, question: '次の関数を微分せよ。<br>$$y=(3x-1)^3$$', answer: '$$ y\' = 9(3x-1)^2 $$' },
        { id: 'p34-n117-s3', page: 34, type: 'TRIAL A', number: 117, sub: 3, question: '次の関数を微分せよ。<br>$$y=(x^2+2x+3)^2$$', answer: '$$ y\' = 4(x+1)(x^2+2x+3) $$' },
        { id: 'p34-n117-s4', page: 34, type: 'TRIAL A', number: 117, sub: 4, question: '次の関数を微分せよ。<br>$$y=\\frac{1}{(2x+3)^2}$$', answer: '$$ y\' = -\\frac{4}{(2x+3)^3} $$' },
        { id: 'p34-n117-s5', page: 34, type: 'TRIAL A', number: 117, sub: 5, question: '次の関数を微分せよ。<br>$$y=\\left(x+\\frac{1}{x}\\right)^4$$', answer: '$$ y\' = 4(x+\\frac{1}{x})^3 (1-\\frac{1}{x^2}) $$' },
        { id: 'p34-n117-s6', page: 34, type: 'TRIAL A', number: 117, sub: 6, question: '次の関数を微分せよ。<br>$$y=(2x-1)(x-2)^2$$', answer: '$$ y\' = 6(x-1)(x-2) $$' },
        { id: 'p34-n118-s1', page: 34, type: 'TRIAL A', number: 118, sub: 1, question: '逆関数の微分法を用いて、次を微分せよ。<br>$$y=\\sqrt[10]{x}$$', answer: '$$ y=x^{1/10} \\implies x=y^{10} \\\\ \\frac{dx}{dy} = 10y^9 \\\\ \\frac{dy}{dx} = \\frac{1}{10y^9} = \\frac{1}{10\\sqrt[10]{x^9}} $$' },
        { id: 'p34-n118-s2', page: 34, type: 'TRIAL A', number: 118, sub: 2, question: '逆関数の微分法を用いて、次を微分せよ。<br>$$y=\\sqrt[3]{x} \\quad (x>0)$$', answer: '$$ y=x^{1/3} \\implies x=y^3 \\\\ \\frac{dx}{dy} = 3y^2 \\implies \\frac{dy}{dx} = \\frac{1}{3y^2} = \\frac{1}{3\\sqrt[3]{x^2}} $$' },
        { id: 'p34-n119-s1', page: 34, type: 'TRIAL A', number: 119, sub: 1, question: '次の関数を微分せよ。<br>$$y=\\sqrt[4]{x}$$', answer: '$$ y\' = \\frac{1}{4}x^{-3/4} = \\frac{1}{4\\sqrt[4]{x^3}} $$' },
        { id: 'p34-n119-s2', page: 34, type: 'TRIAL A', number: 119, sub: 2, question: '次の関数を微分せよ。<br>$$y=\\frac{1}{\\sqrt[3]{x^2}}$$', answer: '$$ y\' = -\\frac{2}{3}x^{-5/3} = -\\frac{2}{3x\\sqrt[3]{x^2}} $$' },
        { id: 'p34-n119-s3', page: 34, type: 'TRIAL A', number: 119, sub: 3, question: '次の関数を微分せよ。<br>$$y=x^2\\sqrt{x}$$', answer: '$$ y\' = \\frac{5}{2}x^{3/2} = \\frac{5}{2}x\\sqrt{x} $$' },
        
        // P35
        { id: 'p35-n12', page: 35, type: '例題', number: 12, sub: null, question: '$f(x)$が$x=a$で微分可能であるとき、次の極限値を$f\'(a)$で表せ。<br>$$ \\lim_{h \\to 0} \\frac{f(a+2h)-f(a-3h)}{h} $$', answer: '$$ \\lim_{h \\to 0} \\frac{f(a+2h)-f(a) - (f(a-3h)-f(a))}{h} \\\\ = \\lim_{h \\to 0} \\left( \\frac{f(a+2h)-f(a)}{2h} \\cdot 2 - \\frac{f(a-3h)-f(a)}{-3h} \\cdot (-3) \\right) \\\\ = 2f\'(a) - (-3)f\'(a) = 5f\'(a) $$' },
        { id: 'p35-n120-s1', page: 35, type: 'TRIAL B', number: 120, sub: 1, question: '$f(x)$が$x=a$で微分可能であるとき、次の極限値を$f\'(a)$で表せ。<br>$$ \\lim_{h \\to 0} \\frac{f(a-4h)-f(a)}{h} $$', answer: '$$ \\lim_{h \\to 0} \\frac{f(a-4h)-f(a)}{-4h} \\cdot (-4) \\\\ = f\'(a) \\cdot (-4) = -4f\'(a) $$' },
        { id: 'p35-n120-s2', page: 35, type: 'TRIAL B', number: 120, sub: 2, question: '$f(x)$が$x=a$で微分可能であるとき、次の極限値を$f\'(a)$で表せ。<br>$$ \\lim_{h \\to 0} \\frac{f(a+3h)-f(a+2h)}{h} $$', answer: '$$ \\lim_{h \\to 0} \\frac{f(a+3h)-f(a) - (f(a+2h)-f(a))}{h} \\\\ = \\lim_{h \\to 0} \\left( \\frac{f(a+3h)-f(a)}{3h}\\cdot 3 - \\frac{f(a+2h)-f(a)}{2h}\\cdot 2 \\right) \\\\ = 3f\'(a) - 2f\'(a) = f\'(a) $$' },
        { id: 'p35-n121', page: 35, type: 'TRIAL B', number: 121, sub: null, question: '次の関数 $f(x)$ は、$x=0$で連続、$x=0$で微分可能でないことを示せ。<br>$$f(x)=x\\sin\\frac{1}{x} \\, (x \\neq 0), \\quad f(0)=0$$', answer: '$$ \\text{連続性：} \\\\ -|x| \\le x\\sin(1/x) \\le |x| \\text{であり、} \\lim_{x \\to 0} |x| = 0 \\text{なので、} \\\\ \\text{はさみうちの原理より } \\lim_{x \\to 0} x\\sin(1/x) = 0 = f(0) \\\\ \\therefore \\text{連続である。} \\\\ \\text{微分可能性：} \\\\ \\lim_{h \\to 0} \\frac{f(h)-f(0)}{h} = \\lim_{h \\to 0} \\frac{h\\sin(1/h)}{h} = \\lim_{h \\to 0} \\sin(1/h) \\\\ h \\to 0 のときこの極限は振動して存在しない。\\\\ \\therefore \\text{微分可能ではない。} $$' },
        { id: 'p35-n122-s1', page: 35, type: 'TRIAL B', number: 122, sub: 1, question: '次の関数を微分せよ。<br>$$ y=(x+2)(x-1)(x-5) $$', answer: '$$ y=(x^2+x-2)(x-5) \\\\ y\'=(2x+1)(x-5) + (x^2+x-2)(1) \\\\ = (2x^2-9x-5) + (x^2+x-2) \\\\ = 3x^2-8x-7 $$' },
        { id: 'p35-n122-s2', page: 35, type: 'TRIAL B', number: 122, sub: 2, question: '次の関数を微分せよ。<br>$$ y=(x^2-1)(x+2)(2x-1) $$', answer: '$$ y=(x^3+2x^2-x-2)(2x-1) \\\\ y\'=(3x^2+4x-1)(2x-1) + (x^3+2x^2-x-2)(2) \\\\ = (6x^3+5x^2-6x+1) + (2x^3+4x^2-2x-4) \\\\ = 8x^3+9x^2-8x-3 $$' },
        { id: 'p35-n123-s1', page: 35, type: 'TRIAL B', number: 123, sub: 1, question: '次の関数を微分せよ。<br>$$ y=(1+x^2)^3 $$', answer: '$$ y\' = 3(1+x^2)^2 \\cdot (2x) = 6x(1+x^2)^2 $$' },
        { id: 'p35-n123-s2', page: 35, type: 'TRIAL B', number: 123, sub: 2, question: '次の関数を微分せよ。<br>$$ y=\\frac{1}{x\\sqrt{x}} $$', answer: '$$ y=x^{-3/2} \\implies y\' = -\\frac{3}{2}x^{-5/2} = -\\frac{3}{2x^2\\sqrt{x}} $$' },
        { id: 'p35-n123-s3', page: 35, type: 'TRIAL B', number: 123, sub: 3, question: '次の関数を微分せよ。<br>$$ y=x\\sqrt{x^2+2} $$', answer: '$$ y\' = (1)\\sqrt{x^2+2} + x \\cdot \\frac{2x}{2\\sqrt{x^2+2}} \\\\ = \\frac{(x^2+2)+x^2}{\\sqrt{x^2+2}} = \\frac{2x^2+2}{\\sqrt{x^2+2}} $$' },
        { id: 'p35-n123-s4', page: 35, type: 'TRIAL B', number: 123, sub: 4, question: '次の関数を微分せよ。<br>$$ y=-\\frac{x}{\\sqrt{1-x^2}} $$', answer: '$$ y\' = -\\frac{(1)\\sqrt{1-x^2} - x (\\frac{-2x}{2\\sqrt{1-x^2}})}{1-x^2} \\\\ = -\\frac{(1-x^2)+x^2}{(1-x^2)\\sqrt{1-x^2}} = -\\frac{1}{(1-x^2)^{3/2}} $$' },
        { id: 'p35-n123-s5', page: 35, type: 'TRIAL B', number: 123, sub: 5, question: '次の関数を微分せよ。<br>$$ y=\\sqrt{1+\\frac{1}{x}} $$', answer: '$$ y=(1+x^{-1})^{1/2} \\\\ y\' = \\frac{1}{2}(1+x^{-1})^{-1/2} \\cdot (-x^{-2}) \\\\ = -\\frac{1}{2x^2\\sqrt{1+1/x}} = -\\frac{1}{2x\\sqrt{x(x+1)}} $$' },
        { id: 'p35-n123-s6', page: 35, type: 'TRIAL B', number: 123, sub: 6, question: '次の関数を微分せよ。<br>$$ y=\\frac{1}{x+\\sqrt{1+x^2}} $$', answer: '$$ y\' = -\\frac{1+\\frac{x}{\\sqrt{1+x^2}}}{(x+\\sqrt{1+x^2})^2} = -\\frac{\\frac{\\sqrt{1+x^2}+x}{\\sqrt{1+x^2}}}{(x+\\sqrt{1+x^2})^2} \\\\ = -\\frac{1}{\\sqrt{1+x^2}(x+\\sqrt{1+x^2})} $$' },
        { id: 'p35-n124-s1', page: 35, type: 'TRIAL B', number: 124, sub: 1, question: '次の関係から$\\frac{dy}{dx}$を求めよ。<br>$$ y=x^2-2y $$', answer: '$$ 3y=x^2 \\implies y=\\frac{1}{3}x^2 \\implies \\frac{dy}{dx} = \\frac{2}{3}x $$' },
        { id: 'p35-n124-s2', page: 35, type: 'TRIAL B', number: 124, sub: 2, question: '次の関係から$\\frac{dy}{dx}$を求めよ。<br>$$ x=y^2+y+1 $$', answer: '$$ \\frac{dx}{dy} = 2y+1 \\implies \\frac{dy}{dx} = \\frac{1}{2y+1} \\\\ x=y^2+y+1 \\implies y = \\frac{-1 \\pm \\sqrt{4x-3}}{2} \\\\ 2y+1 = \\pm \\sqrt{4x-3} \\\\ \\therefore \\frac{dy}{dx} = \\pm \\frac{1}{\\sqrt{4x-3}} $$' },
        
        // P36
        { id: 'p36-n13', page: 36, type: '例題', number: 13, sub: null, question: '$f(x) = \\begin{cases} x^3+ax & (x \\ge 2) \\\\ bx^2-ax & (x < 2) \\end{cases}$ が $x=2$ で微分可能であるとき、$a, b$ の値を求めよ。', answer: '$$ x=2で連続であることから、\\\\ \\lim_{x \\to 2+0} f(x) = 8+2a, \\lim_{x \\to 2-0} f(x) = 4b-2a \\\\ \\implies a-b+2=0 \\cdots ① \\\\ x=2で微分係数が一致することから、\\\\ f\'(x)=3x^2+a (x>2), f\'(x)=2bx-a (x<2) \\\\ \\lim_{x \\to 2+0} f\'(x) = 12+a, \\lim_{x \\to 2-0} f\'(x) = 4b-a \\\\ \\implies a-2b+6=0 \\cdots ② \\\\ ①,②より a=2, b=4 $$' },
        { id: 'p36-n125', page: 36, type: '練習問題', number: 125, sub: null, question: '$f(x) = \\begin{cases} -x+2 & (x \\ge 1) \\\\ \\frac{ax+b}{x+1} & (x < 1) \\end{cases}$ が $x=1$ で微分可能であるとき、$a, b$ の値を求めよ。', answer: '$$ x=1で連続であることから、\\\\ 1 = \\frac{a+b}{2} \\implies a+b=2 \\cdots ① \\\\ f\'(x)=-1 (x>1) \\\\ f\'(x)=\\frac{a(x+1)-(ax+b)}{(x+1)^2} = \\frac{a-b}{(x+1)^2} (x<1) \\\\ x=1で微分係数が一致するので、\\\\ -1 = \\frac{a-b}{4} \\implies a-b=-4 \\cdots ② \\\\ ①,②より a=-1, b=3 $$' },
        { id: 'p36-n126-s1', page: 36, type: 'TRIAL A', number: 126, sub: 1, question: '$f(f(x))=f(x)$ を満たす微分可能な関数は、$f(x)$が定数関数か、$f(x)=x$に限ることを示せ。', answer: '$f(f(x))=f(x)$ の両辺を$x$で微分すると、$$f\'(f(x)) \\cdot f\'(x) = f\'(x)$$ $$f\'(x) (f\'(f(x)) - 1) = 0$$ これは、すべての$x$で $f\'(x)=0$ または $f\'(f(x))=1$ を意味する。\\\\ [1] すべての$x$で $f\'(x)=0$ の場合、$f(x)$は定数関数。\\\\ [2] ある$x$で $f\'(x) \\neq 0$ の場合、その$x$の近傍で $f\'(f(x))=1$。$f$が定数でないなら、値域のある区間内のすべての$y$に対し $f\'(y)=1$。これは $f(y)=y+C$ を意味する。元の式に代入すると、$C=0$。よって $f(x)=x$。' },
        { id: 'p36-n126-s2', page: 36, type: 'TRIAL A', number: 126, sub: 2, question: '$g(f(x))$が微分可能でも、$f(x)$が微分可能とは限らない例を挙げよ。', answer: '$$ f(x)=|x|, g(x)=x^2 とする。\\\\ f(x)はx=0で微分不可能である。\\\\ 一方、合成関数は g(f(x)) = (|x|)^2 = x^2 となり、これはすべてのxで微分可能である。\\\\ よって、g(f(x))が微分可能でもf(x)が微分可能とは限らない。$$' },
        
        // P37
        { id: 'p37-n127-s1', page: 37, type: 'TRIAL A', number: 127, sub: 1, question: '次の関数を微分せよ。<br>$$y=2x-\\cos x$$', answer: '$$ y\'=2-(-\\sin x) = 2+\\sin x $$' },
        { id: 'p37-n127-s2', page: 37, type: 'TRIAL A', number: 127, sub: 2, question: '次の関数を微分せよ。<br>$$y=\\sin x - \\tan x$$', answer: '$$ y\'=\\cos x - \\frac{1}{\\cos^2 x} $$' },
        { id: 'p37-n127-s3', page: 37, type: 'TRIAL A', number: 127, sub: 3, question: '次の関数を微分せよ。<br>$$y=\\cos(2x-1)$$', answer: '$$ y\'=-\\sin(2x-1) \\cdot 2 = -2\\sin(2x-1) $$' },
        { id: 'p37-n127-s4', page: 37, type: 'TRIAL A', number: 127, sub: 4, question: '次の関数を微分せよ。<br>$$y=\\tan 3x$$', answer: '$$ y\'=\\frac{1}{\\cos^2 3x} \\cdot 3 = \\frac{3}{\\cos^2 3x} $$' },
        { id: 'p37-n127-s5', page: 37, type: 'TRIAL A', number: 127, sub: 5, question: '次の関数を微分せよ。<br>$$y=\\sin x^2$$', answer: '$$ y\'=\\cos x^2 \\cdot 2x = 2x\\cos x^2 $$' },
        { id: 'p37-n127-s6', page: 37, type: 'TRIAL A', number: 127, sub: 6, question: '次の関数を微分せよ。<br>$$y=\\tan x^2$$', answer: '$$ y\'=\\frac{1}{\\cos^2 x^2} \\cdot 2x = \\frac{2x}{\\cos^2 x^2} $$' },
        { id: 'p37-n127-s7', page: 37, type: 'TRIAL A', number: 127, sub: 7, question: '次の関数を微分せよ。<br>$$y=2x \\sin x$$', answer: '$$ y\'=2\\sin x + 2x\\cos x $$' },
        { id: 'p37-n127-s8', page: 37, type: 'TRIAL A', number: 127, sub: 8, question: '次の関数を微分せよ。<br>$$y=\\cos^3 x$$', answer: '$$ y\'=3\\cos^2 x \\cdot (-\\sin x) = -3\\sin x \\cos^2 x $$' },
        { id: 'p37-n127-s9', page: 37, type: 'TRIAL A', number: 127, sub: 9, question: '次の関数を微分せよ。<br>$$y=\\frac{1}{\\cos x}$$', answer: '$$ y\'=-\\frac{-\\sin x}{\\cos^2 x} = \\frac{\\sin x}{\\cos^2 x} $$' },
        { id: 'p37-n127-s10', page: 37, type: 'TRIAL A', number: 127, sub: 10, question: '次の関数を微分せよ。<br>$$y=\\sin^2 2x$$', answer: '$$ y\'=2\\sin 2x \\cdot (\\cos 2x \\cdot 2) = 4\\sin 2x \\cos 2x = 2\\sin 4x $$' },
        { id: 'p37-n127-s11', page: 37, type: 'TRIAL A', number: 127, sub: 11, question: '次の関数を微分せよ。<br>$$y=x\\sin x + \\cos x$$', answer: '$$ y\'=(1\\sin x + x\\cos x) - \\sin x = x\\cos x $$' },
        { id: 'p37-n127-s12', page: 37, type: 'TRIAL A', number: 127, sub: 12, question: '次の関数を微分せよ。<br>$$y=\\sin 3x \\cos 5x$$', answer: '$$ y\'=(3\\cos 3x)\\cos 5x + \\sin 3x(-5\\sin 5x) \\\\= 3\\cos 3x \\cos 5x - 5\\sin 3x \\sin 5x $$' },
        { id: 'p37-n128-s1', page: 37, type: 'TRIAL A', number: 128, sub: 1, question: '次の関数を微分せよ。<br>$$y=\\log 4x$$', answer: '$$ y\'=\\frac{(4x)\'}{4x} = \\frac{4}{4x} = \\frac{1}{x} $$' },
        { id: 'p37-n128-s2', page: 37, type: 'TRIAL A', number: 128, sub: 2, question: '次の関数を微分せよ。<br>$$y=\\log_2(3x-2)$$', answer: '$$ y\'=\\frac{(3x-2)\'}{(3x-2)\\log 2} = \\frac{3}{(3x-2)\\log 2} $$' },
        { id: 'p37-n128-s3', page: 37, type: 'TRIAL A', number: 128, sub: 3, question: '次の関数を微分せよ。<br>$$y=\\log(x^2+2)$$', answer: '$$ y\'=\\frac{2x}{x^2+2} $$' },
        { id: 'p37-n128-s4', page: 37, type: 'TRIAL A', number: 128, sub: 4, question: '次の関数を微分せよ。<br>$$y=2x\\log_3 x$$', answer: '$$ y\'=2\\log_3 x + 2x \\cdot \\frac{1}{x\\log 3} = 2\\log_3 x + \\frac{2}{\\log 3} $$' },
        { id: 'p37-n128-s5', page: 37, type: 'TRIAL A', number: 128, sub: 5, question: '次の関数を微分せよ。<br>$$y=(\\log x)^2$$', answer: '$$ y\'=2(\\log x) \\cdot \\frac{1}{x} = \\frac{2\\log x}{x} $$' },
        { id: 'p37-n128-s6', page: 37, type: 'TRIAL A', number: 128, sub: 6, question: '次の関数を微分せよ。<br>$$y=\\log_a |x^2-5|$$', answer: '$$ y\'=\\frac{(x^2-5)\'}{(x^2-5)\\log a} = \\frac{2x}{(x^2-5)\\log a} $$' },
        { id: 'p37-n129-s1', page: 37, type: 'TRIAL A', number: 129, sub: 1, question: '次の関数を微分せよ。<br>$$y=e^{2x+1}$$', answer: '$$ y\'=e^{2x+1} \\cdot (2x+1)\' = 2e^{2x+1} $$' },
        { id: 'p37-n129-s2', page: 37, type: 'TRIAL A', number: 129, sub: 2, question: '次の関数を微分せよ。<br>$$y=4^x$$', answer: '$$ y\'=4^x \\log 4 $$' },
        { id: 'p37-n129-s3', page: 37, type: 'TRIAL A', number: 129, sub: 3, question: '次の関数を微分せよ。<br>$$y=xe^{-3x}$$', answer: '$$ y\'=1\\cdot e^{-3x} + x \\cdot e^{-3x}(-3) = (1-3x)e^{-3x} $$' },
        { id: 'p37-n129-s4', page: 37, type: 'TRIAL A', number: 129, sub: 4, question: '次の関数を微分せよ。<br>$$y=e^x\\cos x$$', answer: '$$ y\'=e^x\\cos x + e^x(-\\sin x) = e^x(\\cos x - \\sin x) $$' },
        { id: 'p37-n129-s5', page: 37, type: 'TRIAL A', number: 129, sub: 5, question: '次の関数を微分せよ。<br>$$y=(x+1)3^x$$', answer: '$$ y\'=1\\cdot 3^x + (x+1)3^x\\log 3 = (1+(x+1)\\log 3)3^x $$' },
        { id: 'p37-n129-s6', page: 37, type: 'TRIAL A', number: 129, sub: 6, question: '次の関数を微分せよ。<br>$$y=a^{-3x}$$', answer: '$$ y\'=a^{-3x}(\\log a)(-3) = -3a^{-3x}\\log a $$' },

        // P38
        { id: 'p38-n130-s1', page: 38, type: 'TRIAL B', number: 130, sub: 1, question: '次の関数を微分せよ。<br>$$y=\\cos(\\sin x)$$', answer: '$$ y\'=-\\sin(\\sin x) \\cdot (\\cos x) = -\\cos x \\sin(\\sin x) $$' },
        { id: 'p38-n130-s2', page: 38, type: 'TRIAL B', number: 130, sub: 2, question: '次の関数を微分せよ。<br>$$y=\\sin^2 x \\cos 5x$$', answer: '$$ y\'=(2\\sin x \\cos x)\\cos 5x + \\sin^2 x(-5\\sin 5x) \\\\ = \\sin 2x \\cos 5x - 5\\sin^2 x \\sin 5x $$' },
        { id: 'p38-n130-s3', page: 38, type: 'TRIAL B', number: 130, sub: 3, question: '次の関数を微分せよ。<br>$$y=e^{-2x}\\sin 2x$$', answer: '$$ y\'=e^{-2x}(-2)\\sin 2x + e^{-2x}(\\cos 2x \\cdot 2) \\\\ = 2e^{-2x}(\\cos 2x - \\sin 2x) $$' },
        { id: 'p38-n130-s4', page: 38, type: 'TRIAL B', number: 130, sub: 4, question: '次の関数を微分せよ。<br>$$y=\\log\\left|\\frac{2x-1}{2x+1}\\right|$$', answer: '$$ y=\\log|2x-1|-\\log|2x+1| \\\\ y\'=\\frac{2}{2x-1} - \\frac{2}{2x+1} = \\frac{4}{4x^2-1} $$' },
        { id: 'p38-n130-s5', page: 38, type: 'TRIAL B', number: 130, sub: 5, question: '次の関数を微分せよ。<br>$$y=\\sin\\sqrt{x^2+x+1}$$', answer: '$$ y\'=\\cos\\sqrt{x^2+x+1} \\cdot \\frac{2x+1}{2\\sqrt{x^2+x+1}} \\\\ = \\frac{(2x+1)\\cos\\sqrt{x^2+x+1}}{2\\sqrt{x^2+x+1}} $$' },
        { id: 'p38-n130-s6', page: 38, type: 'TRIAL B', number: 130, sub: 6, question: '次の関数を微分せよ。<br>$$y=\\sqrt{1+\\sin^2 x}$$', answer: '$$ y\'=\\frac{2\\sin x \\cos x}{2\\sqrt{1+\\sin^2 x}} = \\frac{\\sin 2x}{2\\sqrt{1+\\sin^2 x}} $$' },
        { id: 'p38-n130-s7', page: 38, type: 'TRIAL B', number: 130, sub: 7, question: '次の関数を微分せよ。<br>$$y=\\frac{1}{\\cos x + e^{-x}}$$', answer: '$$ y\'=-\\frac{-\\sin x - e^{-x}}{(\\cos x + e^{-x})^2} = \\frac{\\sin x+e^{-x}}{(\\cos x+e^{-x})^2} $$' },
        { id: 'p38-n130-s8', page: 38, type: 'TRIAL B', number: 130, sub: 8, question: '次の関数を微分せよ。<br>$$y=\\log\\frac{|x|}{1+\\cos x}$$', answer: '$$ y=\\log|x|-\\log(1+\\cos x) \\\\ y\'=\\frac{1}{x} - \\frac{-\\sin x}{1+\\cos x} = \\frac{1}{x} + \\frac{\\sin x}{1+\\cos x} $$' },
        { id: 'p38-n131-s1', page: 38, type: 'TRIAL B', number: 131, sub: 1, question: '$\\log|y|$の導関数を利用して、次を微分せよ。<br>$$y=(2x-1)^4(3-x)^3$$', answer: '$$ \\log|y|=4\\log|2x-1|+3\\log|3-x| \\\\ \\frac{y\'}{y} = \\frac{8}{2x-1} - \\frac{3}{3-x} = \\frac{14x-27}{(2x-1)(x-3)} \\\\ y\' = (14x-27)(2x-1)^3(3-x)^2 $$' },
        { id: 'p38-n131-s2', page: 38, type: 'TRIAL B', number: 131, sub: 2, question: '$\\log|y|$の導関数を利用して、次を微分せよ。<br>$$y=(x+2)^2(x+3)^3(x+4)^4$$', answer: '$$ \\log|y|=2\\log|x+2|+3\\log|x+3|+4\\log|x+4| \\\\ \\frac{y\'}{y}=\\frac{2}{x+2}+\\frac{3}{x+3}+\\frac{4}{x+4} \\\\ =\\frac{9x^2+52x+72}{(x+2)(x+3)(x+4)} \\\\ y\'=(9x^2+52x+72)(x+2)(x+3)^2(x+4)^3 $$' },
        { id: 'p38-n131-s3', page: 38, type: 'TRIAL B', number: 131, sub: 3, question: '$\\log|y|$の導関数を利用して、次を微分せよ。<br>$$y=\\frac{(x+1)^2}{(x+2)^3(x+3)^4}$$', answer: '$$ \\log|y|=2\\log|x+1|-3\\log|x+2|-4\\log|x+3| \\\\ \\frac{y\'}{y}=\\frac{2}{x+1}-\\frac{3}{x+2}-\\frac{4}{x+3} \\\\ = -\\frac{5x^2+14x+5}{(x+1)(x+2)(x+3)} \\\\ y\' = -\\frac{(5x^2+14x+5)(x+1)}{(x+2)^4(x+3)^5} $$' },
        { id: 'p38-n131-s4', page: 38, type: 'TRIAL B', number: 131, sub: 4, question: '$\\log|y|$の導関数を利用して、次を微分せよ。<br>$$y=\\frac{(1+x)^3(1-2x)}{(1-x)(1+2x)^3}$$', answer: '$$ \\log|y|=3\\log|1+x|+\\log|1-2x|-\\log|1-x|-3\\log|1+2x| \\\\ \\frac{y\'}{y}=\\frac{3}{1+x}-\\frac{2}{1-2x}+\\frac{1}{1-x}-\\frac{6}{1+2x} \\\\ y\'=\\frac{2(1+x^2-4x)(1+x)^2}{(1-x)^2(1+2x)^4} $$' },
        { id: 'p38-n131-s5', page: 38, type: 'TRIAL B', number: 131, sub: 5, question: '$\\log|y|$の導関数を利用して、次を微分せよ。<br>$$y=\\sqrt[3]{(x-2)(x^2-2)}$$', answer: '$$ \\log|y|=\\frac{1}{3}(\\log|x-2|+\\log|x^2-2|) \\\\ \\frac{y\'}{y}=\\frac{1}{3}(\\frac{1}{x-2}+\\frac{2x}{x^2-2}) =\\frac{3x^2-4x-2}{3(x-2)(x^2-2)} \\\\ y\'=\\frac{3x^2-4x-2}{3\\sqrt[3]{((x-2)(x^2-2))^2}} $$' },
        { id: 'p38-n131-s6', page: 38, type: 'TRIAL B', number: 131, sub: 6, question: '$\\log|y|$の導関数を利用して、次を微分せよ。<br>$$y=\\frac{x}{\\sqrt{(a^2+x^2)^3}}$$', answer: '$$ \\log|y|=\\log|x|-\\frac{3}{2}\\log(a^2+x^2) \\\\ \\frac{y\'}{y}=\\frac{1}{x}-\\frac{3x}{a^2+x^2} = \\frac{a^2-2x^2}{x(a^2+x^2)} \\\\ y\' = \\frac{a^2-2x^2}{(a^2+x^2)^{5/2}} $$' },
        { id: 'p38-n14', page: 38, type: '例題', number: 14, sub: null, question: '関数 $y=x^{2x} \\quad (x>0)$ を微分せよ。', answer: '$$ \\log y = 2x \\log x \\\\ \\frac{y\'}{y} = 2\\log x + 2x \\cdot \\frac{1}{x} = 2(\\log x+1) \\\\ y\'= 2x^{2x}(\\log x+1) $$' },
        { id: 'p38-n132-s1', page: 38, type: 'TRIAL B', number: 132, sub: 1, question: '次の関数を微分せよ。<br>$$y=x^{\\sin x} \\quad (x>0)$$', answer: '$$ \\log y = \\sin x \\log x \\\\ \\frac{y\'}{y} = \\cos x \\log x + \\frac{\\sin x}{x} \\\\ y\' = x^{\\sin x} (\\cos x \\log x + \\frac{\\sin x}{x}) $$' },
        { id: 'p38-n132-s2', page: 38, type: 'TRIAL B', number: 132, sub: 2, question: '次の関数を微分せよ。<br>$$y=x^{e^x} \\quad (x>0)$$', answer: '$$ \\log y = e^x \\log x \\\\ \\frac{y\'}{y} = e^x(\\log x + \\frac{1}{x}) \\\\ y\' = x^{e^x} e^x (\\log x + \\frac{1}{x}) $$' },
        { id: 'p38-n132-s3', page: 38, type: 'TRIAL B', number: 132, sub: 3, question: '次の関数を微分せよ。<br>$$y=x^{\\log x} \\quad (x>0)$$', answer: '$$ \\log y = (\\log x)^2 \\\\ \\frac{y\'}{y} = \\frac{2\\log x}{x} \\\\ y\' = x^{\\log x} \\frac{2\\log x}{x} = 2x^{\\log x - 1} \\log x $$' },
        { id: 'p38-n132-s4', page: 38, type: 'TRIAL B', number: 132, sub: 4, question: '次の関数を微分せよ。<br>$$y=(\\log x)^x \\quad (x>1)$$', answer: '$$ \\log y = x \\log(\\log x) \\\\ \\frac{y\'}{y} = \\log(\\log x) + \\frac{1}{\\log x} \\\\ y\' = (\\log x)^x (\\log(\\log x) + \\frac{1}{\\log x}) $$' },
        
        // P39
        { id: 'p39-n133-s1', page: 39, type: 'TRIAL A', number: 133, sub: 1, question: '次の関数の第n次導関数を求めよ。<br>$$y=x^4-3x^2+2 \\quad (n=3)$$', answer: '$$ y\'=4x^3-6x \\\\ y\'\'=12x^2-6 \\\\ y\'\'\'=24x $$' },
        { id: 'p39-n133-s2', page: 39, type: 'TRIAL A', number: 133, sub: 2, question: '次の関数の第n次導関数を求めよ。<br>$$y=\\frac{1}{x+2} \\quad (n=2)$$', answer: '$$ y=(x+2)^{-1} \\\\ y\'=-(x+2)^{-2} \\\\ y\'\'=2(x+2)^{-3} = \\frac{2}{(x+2)^3} $$' },
        { id: 'p39-n133-s3', page: 39, type: 'TRIAL A', number: 133, sub: 3, question: '次の関数の第n次導関数を求めよ。<br>$$y=(2x-1)^4 \\quad (n=3)$$', answer: '$$ y\'=8(2x-1)^3 \\\\ y\'\'=48(2x-1)^2 \\\\ y\'\'\'=192(2x-1) $$' },
        { id: 'p39-n133-s4', page: 39, type: 'TRIAL A', number: 133, sub: 4, question: '次の関数の第n次導関数を求めよ。<br>$$y=e^{-x} \\quad (n=4)$$', answer: '$$ y^{(n)} = (-1)^n e^{-x} \\\\ n=4のとき、y^{(4)}=e^{-x} $$' },
        { id: 'p39-n134-s1', page: 39, type: 'TRIAL A', number: 134, sub: 1, question: '次の方程式で定められるxの関数yについて、$\\frac{dy}{dx}$ を求めよ。<br>$$y^2=8x$$', answer: '$$ 2y \\frac{dy}{dx} = 8 \\implies \\frac{dy}{dx}=\\frac{4}{y} $$' },
        { id: 'p39-n134-s2', page: 39, type: 'TRIAL A', number: 134, sub: 2, question: '次の方程式で定められるxの関数yについて、$\\frac{dy}{dx}$ を求めよ。<br>$$x^2+y^2=5$$', answer: '$$ 2x+2y\\frac{dy}{dx}=0 \\implies \\frac{dy}{dx}=-\\frac{x}{y} $$' },
        { id: 'p39-n134-s3', page: 39, type: 'TRIAL A', number: 134, sub: 3, question: '次の方程式で定められるxの関数yについて、$\\frac{dy}{dx}$ を求めよ。<br>$$\\frac{x^2}{4}-\\frac{y^2}{2}=1$$', answer: '$$ \\frac{x}{2} - y\\frac{dy}{dx}=0 \\implies \\frac{dy}{dx}=\\frac{x}{2y} $$' },
        { id: 'p39-n134-s4', page: 39, type: 'TRIAL A', number: 134, sub: 4, question: '次の方程式で定められるxの関数yについて、$\\frac{dy}{dx}$ を求めよ。<br>$$2xy-3=0$$', answer: '$$ 2y+2x\\frac{dy}{dx}=0 \\implies \\frac{dy}{dx}=-\\frac{y}{x} $$' },
        { id: 'p39-n135-s1', page: 39, type: 'TRIAL A', number: 135, sub: 1, question: '次の媒介変数表示のとき、$\\frac{dy}{dx}$ を $t$ の関数として表せ。<br>$$x=t+1, y=2t-1$$', answer: '$$ \\frac{dx}{dt}=1, \\frac{dy}{dt}=2 \\implies \\frac{dy}{dx}=2 $$' },
        { id: 'p39-n135-s2', page: 39, type: 'TRIAL A', number: 135, sub: 2, question: '次の媒介変数表示のとき、$\\frac{dy}{dx}$ を $t$ の関数として表せ。<br>$$x=2t^2-t+1, y=t^2-2t-1$$', answer: '$$ \\frac{dx}{dt}=4t-1, \\frac{dy}{dt}=2t-2 \\implies \\frac{dy}{dx}=\\frac{2t-2}{4t-1} $$' },
        { id: 'p39-n135-s3', page: 39, type: 'TRIAL A', number: 135, sub: 3, question: '次の媒介変数表示のとき、$\\frac{dy}{dx}$ を $t$ の関数として表せ。<br>$$x=2\\cos 2t, y=\\sin 2t$$', answer: '$$ \\frac{dx}{dt}=-4\\sin 2t, \\frac{dy}{dt}=2\\cos 2t \\implies \\frac{dy}{dx}=-\\frac{\\cos 2t}{2\\sin 2t} $$' },
        { id: 'p39-n135-s4', page: 39, type: 'TRIAL A', number: 135, sub: 4, question: '次の媒介変数表示のとき、$\\frac{dy}{dx}$ を $t$ の関数として表せ。<br>$$x=2(t-\\sin t), y=2(1-\\cos t)$$', answer: '$$ \\frac{dx}{dt}=2(1-\\cos t), \\frac{dy}{dt}=2\\sin t \\\\ \\frac{dy}{dx}=\\frac{\\sin t}{1-\\cos t} = \\frac{2\\sin(t/2)\\cos(t/2)}{2\\sin^2(t/2)} = \\frac{1}{\\tan(t/2)} $$' },

        // P40
        { id: 'p40-n136-s1', page: 40, type: 'TRIAL B', number: 136, sub: 1, question: '次の関数の第3次までの導関数を求めよ。<br>$$y=\\frac{1}{x^2-x}$$', answer: '$$ y=\\frac{1}{x(x-1)}=\\frac{1}{x-1}-\\frac{1}{x} \\\\ y\'=-(x-1)^{-2}+x^{-2} \\\\ y\'\'=2(x-1)^{-3}-2x^{-3} \\\\ y\'\'\'=-6(x-1)^{-4}+6x^{-4} = 6(\\frac{1}{x^4}-\\frac{1}{(x-1)^4}) $$' },
        { id: 'p40-n136-s2', page: 40, type: 'TRIAL B', number: 136, sub: 2, question: '次の関数の第3次までの導関数を求めよ。<br>$$y=\\sqrt{2x+1}$$', answer: '$$ y=(2x+1)^{1/2} \\\\ y\'=\\frac{1}{2}(2x+1)^{-1/2} \\cdot 2 = (2x+1)^{-1/2} \\\\ y\'\'=-\\frac{1}{2}(2x+1)^{-3/2} \\cdot 2 = -(2x+1)^{-3/2} \\\\ y\'\'\'=\\frac{3}{2}(2x+1)^{-5/2} \\cdot 2 = 3(2x+1)^{-5/2} $$' },
        { id: 'p40-n136-s3', page: 40, type: 'TRIAL B', number: 136, sub: 3, question: '次の関数の第3次までの導関数を求めよ。<br>$$y=\\cos^3 x$$', answer: '$$ y\'=3\\cos^2 x(-\\sin x) = -3\\sin x \\cos^2 x \\\\ y\'\'=-3\\cos^3 x -3\\sin x(2\\cos x(-\\sin x)) \\\\ = -3\\cos^3 x + 6\\sin^2 x \\cos x \\\\ = -3\\cos^3 x + 6(1-\\cos^2 x)\\cos x = 6\\cos x - 9\\cos^3 x \\\\ y\'\'\'=-6\\sin x - 27\\cos^2 x(-\\sin x) = -6\\sin x + 27\\sin x \\cos^2 x $$' },
        { id: 'p40-n137-s1', page: 40, type: 'TRIAL B', number: 137, sub: 1, question: '次の媒介変数表示のとき、$\\frac{dy}{dx}$ を $t$ の関数として表せ。<br>$$x=\\sqrt{1-t^2}, y=t^2+1$$', answer: '$$ \\frac{dx}{dt}=\\frac{-2t}{2\\sqrt{1-t^2}}, \\frac{dy}{dt}=2t \\\\ \\frac{dy}{dx}=\\frac{2t}{-t/\\sqrt{1-t^2}} = -2\\sqrt{1-t^2} $$' },
        { id: 'p40-n137-s2', page: 40, type: 'TRIAL B', number: 137, sub: 2, question: '次の媒介変数表示のとき、$\\frac{dy}{dx}$ を $t$ の関数として表せ。<br>$$x=\\cos^3 t, y=2\\sin^3 t$$', answer: '$$ \\frac{dx}{dt}=3\\cos^2 t(-\\sin t), \\frac{dy}{dt}=6\\sin^2 t(\\cos t) \\\\ \\frac{dy}{dx}=\\frac{6\\sin^2 t \\cos t}{-3\\cos^2 t \\sin t} = -2\\frac{\\sin t}{\\cos t}=-2\\tan t $$' },
        { id: 'p40-n137-s3', page: 40, type: 'TRIAL B', number: 137, sub: 3, question: '次の媒介変数表示のとき、$\\frac{dy}{dx}$ を $t$ の関数として表せ。<br>$$x=a(\\cos t + t\\sin t), y=a(\\sin t - t\\cos t)$$', answer: '$$ \\frac{dx}{dt}=a(-\\sin t + \\sin t + t\\cos t) = at\\cos t \\\\ \\frac{dy}{dt}=a(\\cos t - (\\cos t - t\\sin t)) = at\\sin t \\\\ \\frac{dy}{dx}=\\frac{at\\sin t}{at\\cos t} = \\tan t $$' },
        { id: 'p40-n137-s4', page: 40, type: 'TRIAL B', number: 137, sub: 4, question: '次の媒介変数表示のとき、$\\frac{dy}{dx}$ を $t$ の関数として表せ。<br>$$x=\\frac{1+t^2}{1-t^2}, y=\\frac{2t}{1-t^2}$$', answer: '$$ \\frac{dx}{dt}=\\frac{2t(1-t^2)-(1+t^2)(-2t)}{(1-t^2)^2}=\\frac{4t}{(1-t^2)^2} \\\\ \\frac{dy}{dt}=\\frac{2(1-t^2)-2t(-2t)}{(1-t^2)^2}=\\frac{2+2t^2}{(1-t^2)^2} \\\\ \\frac{dy}{dx}=\\frac{2(1+t^2)}{4t}=\\frac{1+t^2}{2t} $$' },
        { id: 'p40-n138', page: 40, type: 'TRIAL B', number: 138, sub: null, question: '$f(x)=\\log x$ について、$f^{(n)}(x)=(-1)^{n-1}\\frac{(n-1)!}{x^n}$ を数学的帰納法で証明せよ。', answer: '$$ [1] n=1のとき \\\\ f\'(x)=1/x。右辺は(-1)^0 \\frac{0!}{x^1} = 1/x。成立。\\\\ [2] n=kで成立すると仮定。\\\\ f^{(k)}(x)=(-1)^{k-1}\\frac{(k-1)!}{x^k} \\\\ 両辺を微分すると、 \\\\ f^{(k+1)}(x)=(-1)^{k-1}(k-1)! \\cdot (-k)x^{-k-1} \\\\ = (-1)^k k! x^{-(k+1)} = (-1)^{(k+1)-1} \\frac{k!}{x^{k+1}} \\\\ これはn=k+1のときも成立。\\\\ よって、すべての自然数nで成立する。$$' },
        { id: 'p40-n139', page: 40, type: 'TRIAL B', number: 139, sub: null, question: '関数 $y=e^x\\sin x$ について、$y\'\'-2y\'+2y=0$ が成り立つことを示せ。', answer: '$$ y\' = e^x\\sin x + e^x\\cos x = e^x(\\sin x + \\cos x) \\\\ y\'\' = e^x(\\sin x + \\cos x) + e^x(\\cos x - \\sin x) = 2e^x\\cos x \\\\ y\'\'-2y\'+2y \\\\ = 2e^x\\cos x - 2e^x(\\sin x + \\cos x) + 2e^x\\sin x \\\\ = (2-2)e^x\\cos x + (-2+2)e^x\\sin x = 0 $$' },
        { id: 'p40-n140', page: 40, type: 'TRIAL B', number: 140, sub: null, question: '2次関数 $f(x)$ が $f\'\'(x)+2f\'(x)=8x$ と $f(0)=1$ を満たすとき、$f(x)$を求めよ。', answer: '$$ f(x)=ax^2+bx+c とおく。f\'(x)=2ax+b, f\'\'(x)=2a。\\\\ f\'\'(x)+2f\'(x) = 2a+2(2ax+b) = 4ax+2a+2b \\\\ これが8xと等しいので、係数比較して \\\\ 4a=8, 2a+2b=0 \\implies a=2, b=-2 \\\\ f(0)=1より c=1。\\\\ \\therefore f(x)=2x^2-2x+1 $$' },
        { id: 'p40-n141-s1', page: 40, type: 'TRIAL B', number: 141, sub: 1, question: '次の方程式で定められるxの関数yについて、$\\frac{dy}{dx}$ を求めよ。<br>$$(y+1)^2=x^2+x$$', answer: '$$ 2(y+1)\\frac{dy}{dx} = 2x+1 \\implies \\frac{dy}{dx} = \\frac{2x+1}{2(y+1)} $$' },
        { id: 'p40-n141-s2', page: 40, type: 'TRIAL B', number: 141, sub: 2, question: '次の方程式で定められるxの関数yについて、$\\frac{dy}{dx}$ を求めよ。<br>$$x^2+3xy-y^2=1$$', answer: '$$ 2x + (3y+3x\\frac{dy}{dx}) - 2y\\frac{dy}{dx} = 0 \\\\ (3x-2y)\\frac{dy}{dx} = -2x-3y \\\\ \\frac{dy}{dx} = -\\frac{2x+3y}{3x-2y} = \\frac{2x+3y}{2y-3x} $$' },
        { id: 'p40-n141-s3', page: 40, type: 'TRIAL B', number: 141, sub: 3, question: '次の方程式で定められるxの関数yについて、$\\frac{dy}{dx}$ を求めよ。<br>$$x^{\\frac{1}{3}}+y^{\\frac{1}{3}}=1$$', answer: '$$ \\frac{1}{3}x^{-2/3} + \\frac{1}{3}y^{-2/3}\\frac{dy}{dx} = 0 \\\\ \\frac{dy}{dx} = -\\frac{x^{-2/3}}{y^{-2/3}} = -\\left(\\frac{y}{x}\\right)^{2/3} = -\\sqrt[3]{\\frac{y^2}{x^2}} $$' },
        { id: 'p40-n141-s4', page: 40, type: 'TRIAL B', number: 141, sub: 4, question: '次の方程式で定められるxの関数yについて、$\\frac{dy}{dx}$ を求めよ。<br>$$\\sqrt{x}+\\sqrt{y}=1$$', answer: '$$ \\frac{1}{2\\sqrt{x}} + \\frac{1}{2\\sqrt{y}}\\frac{dy}{dx} = 0 \\\\ \\frac{dy}{dx} = -\\frac{\\sqrt{y}}{\\sqrt{x}} $$' },

        // P41
        { id: 'p41-n15-s1', page: 41, type: '例題', number: 15, sub: 1, question: '$\\lim_{k \\to 0} (1+k)^{1/k}=e$ を用いて、次の極限を求めよ。<br>$$ \\lim_{h \\to 0} (1+2h)^{1/h} $$', answer: '$$ 2h=t とおくと h=t/2。h \\to 0 のとき t \\to 0。\\\\ \\lim_{t \\to 0} (1+t)^{2/t} = \\lim_{t \\to 0} ((1+t)^{1/t})^2 = e^2 $$' },
        { id: 'p41-n15-s2', page: 41, type: '例題', number: 15, sub: 2, question: '$\\lim_{k \\to 0} (1+k)^{1/k}=e$ を用いて、次の極限を求めよ。<br>$$ \\lim_{x \\to 0} \\frac{\\log(1-x)}{x} $$', answer: '$$ -x=t とおくと x=-t。x \\to 0 のとき t \\to 0。\\\\ \\lim_{t \\to 0} \\frac{\\log(1+t)}{-t} = \\lim_{t \\to 0} -\\frac{1}{t}\\log(1+t) \\\\ = \\lim_{t \\to 0} \\log((1+t)^{1/t})^{-1} = \\log e^{-1} = -1 $$' },
        { id: 'p41-n142-s1', page: 41, type: '練習問題', number: 142, sub: 1, question: '$\\lim_{k \\to 0} (1+k)^{1/k}=e$ を用いて、次の極限を求めよ。<br>$$ \\lim_{h \\to 0} (1-2h)^{1/h} $$', answer: '$$ -2h=t とおくと h=-t/2。h \\to 0 のとき t \\to 0。\\\\ \\lim_{t \\to 0} (1+t)^{-2/t} = \\lim_{t \\to 0} ((1+t)^{1/t})^{-2} = e^{-2} $$' },
        { id: 'p41-n142-s2', page: 41, type: '練習問題', number: 142, sub: 2, question: '$\\lim_{k \\to 0} (1+k)^{1/k}=e$ を用いて、次の極限を求めよ。<br>$$ \\lim_{x \\to 0} \\frac{\\log(1+3x)}{x} $$', answer: '$$ 3x=t とおくと x=t/3。x \\to 0 のとき t \\to 0。\\\\ \\lim_{t \\to 0} \\frac{\\log(1+t)}{t/3} = \\lim_{t \\to 0} 3 \\cdot \\frac{1}{t}\\log(1+t) \\\\ = \\lim_{t \\to 0} \\log((1+t)^{1/t})^3 = \\log e^3 = 3 $$' },
        { id: 'p41-n143-s1', page: 41, type: '練習問題', number: 143, sub: 1, question: '$\\lim_{x \\to \\infty}(1+1/x)^x=e$ を用いて、次の極限を求めよ。<br>$$ \\lim_{x \\to \\infty} \\left(1-\\frac{1}{2x}\\right)^x $$', answer: '$$ -2x=t とおくと x=-t/2。x \\to \\infty のとき t \\to -\\infty。\\\\ \\lim_{t \\to -\\infty} (1+1/t)^{-t/2} = \\lim_{t \\to -\\infty} ((1+1/t)^t)^{-1/2} = e^{-1/2} $$' },
        { id: 'p41-n143-s2', page: 41, type: '練習問題', number: 143, sub: 2, question: '$\\lim_{x \\to \\infty}(1+1/x)^x=e$ を用いて、次の極限を求めよ。<br>$$ \\lim_{x \\to \\infty} \\left(\\frac{x}{x+1}\\right)^x $$', answer: '$$ \\lim_{x \\to \\infty} \\left(\\frac{1}{1+1/x}\\right)^x = \\lim_{x \\to \\infty} \\frac{1}{(1+1/x)^x} = \\frac{1}{e} $$' },
        { id: 'p41-n144-s1', page: 41, type: '練習問題', number: 144, sub: 1, question: '次の極限を求めよ。<br>$$ \\lim_{x \\to 1} \\frac{\\log x}{x-1} $$', answer: '$$ f(x)=\\log x とおくと f(1)=0。\\\\ \\lim_{x \\to 1} \\frac{\\log x - \\log 1}{x-1} = f\'(1) \\\\ f\'(x)=1/x なので f\'(1)=1。$$' },
        { id: 'p41-n144-s2', page: 41, type: '練習問題', number: 144, sub: 2, question: '次の極限を求めよ。<br>$$ \\lim_{h \\to 0} \\frac{e^{2h+1}-e}{h} $$', answer: '$$ f(x)=e^{2x+1} とおくと f(0)=e。\\\\ \\lim_{h \\to 0} \\frac{f(h)-f(0)}{h} = f\'(0) \\\\ f\'(x)=2e^{2x+1} なので f\'(0)=2e。$$' }
    ];
    
    // (JavaScriptロジックは変更なしのため省略)
    const state = { currentIndex: 0, filteredProblems: [], problemData: [] };
    const elements = {
        problemWrapper: document.getElementById('problem-wrapper'),
        noProblemMessage: document.getElementById('no-problem-message'),
        header: document.getElementById('problem-header'),
        body: document.getElementById('problem-body'),
        answerContainer: document.getElementById('answer-container'),
        answerHeader: document.getElementById('answer-header'),
        answerBody: document.getElementById('answer-body'),
        toggleBtn: document.getElementById('answer-toggle-btn'),
        prevBtn: document.getElementById('prev-btn'),
        nextBtn: document.getElementById('next-btn'),
        counter: document.getElementById('problem-counter'),
        typeFilters: document.getElementById('type-filters'),
        statusFilters: document.getElementById('status-filters'),
        randomModeCheckbox: document.getElementById('random-mode'),
        statusControls: document.querySelector('.status-controls'),
        sliderContainer: document.getElementById('slider-container'),
        problemSlider: document.getElementById('problem-slider'),
    };
    function loadStatus() {
        const statuses = JSON.parse(localStorage.getItem('math3-statuses-vFinal')) || {};
        state.problemData = problems.map(p => ({ ...p, status: statuses[p.id] || 'unsolved' }));
    }
    function saveStatus(problemId, status) {
        const statuses = JSON.parse(localStorage.getItem('math3-statuses-vFinal')) || {};
        statuses[problemId] = status;
        localStorage.setItem('math3-statuses-vFinal', JSON.stringify(statuses));
        const problem = state.problemData.find(p => p.id === problemId);
        if (problem) {
            problem.status = status;
            updateStatusCounts();
        }
    }
    function updateStatusCounts() {
        const selectedTypes = Array.from(elements.typeFilters.querySelectorAll('input[type=checkbox]:checked')).map(el => el.value);
        const relevantProblems = state.problemData.filter(p => selectedTypes.includes(p.type));
        
        const counts = { unsolved: 0, solved: 0, attention: 0 };
        relevantProblems.forEach(p => { counts[p.status]++; });

        elements.statusFilters.querySelector('[data-status-label="unsolved"]').innerHTML = `<input type="radio" name="status" value="unsolved"> 未 (${counts.unsolved})`;
        elements.statusFilters.querySelector('[data-status-label="solved"]').innerHTML = `<input type="radio" name="status" value="solved"> 済 (${counts.solved})`;
        elements.statusFilters.querySelector('[data-status-label="attention"]').innerHTML = `<input type="radio" name="status" value="attention"> 注 (${counts.attention})`;
        elements.statusFilters.querySelector('[data-status-label="all"]').innerHTML = `<input type="radio" name="status" value="all"> 全 (${relevantProblems.length})`;

        const currentStatus = elements.statusFilters.querySelector('input[name=status]:checked')?.value || 'unsolved';
        elements.statusFilters.querySelector(`input[value=${currentStatus}]`).checked = true;
    }
    function updateProblemList() {
        updateStatusCounts();
        const selectedTypes = Array.from(elements.typeFilters.querySelectorAll('input[type=checkbox]:checked')).map(el => el.value);
        const selectedStatus = elements.statusFilters.querySelector('input:checked').value;
        const isRandom = elements.randomModeCheckbox.checked;
        
        let list = state.problemData.filter(p => selectedTypes.includes(p.type));
        if (selectedStatus !== 'all') { list = list.filter(p => p.status === selectedStatus); }

        if (isRandom) {
            for (let i = list.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [list[i], list[j]] = [list[j], list[i]];
            }
        } else {
            list.sort((a,b) => a.page - b.page || a.number - b.number || (a.sub || 0) - (b.sub || 0));
        }
        state.filteredProblems = list;
        state.currentIndex = 0;
        render();
    }
    function updateSlider() {
        const isRandom = elements.randomModeCheckbox.checked;
        if (isRandom || state.filteredProblems.length <= 1) {
            elements.sliderContainer.style.display = 'none';
            return;
        }
        elements.sliderContainer.style.display = 'block';
        elements.problemSlider.max = state.filteredProblems.length - 1;
        elements.problemSlider.value = state.currentIndex;
    }
    function render() {
        if (state.filteredProblems.length === 0) {
            elements.problemWrapper.style.display = 'none';
            elements.noProblemMessage.style.display = 'block';
            return;
        }
        elements.problemWrapper.style.display = 'block';
        elements.noProblemMessage.style.display = 'none';
        const problem = state.filteredProblems[state.currentIndex];
        const isRandom = elements.randomModeCheckbox.checked;
        const headerText = `P.${problem.page} | ${problem.type} ${problem.number}${problem.sub ? ` (${problem.sub})` : ''}`;
        
        elements.header.style.display = isRandom ? 'none' : 'block';
        if (!isRandom) { elements.header.textContent = headerText; }
        
        elements.body.innerHTML = problem.question;
        elements.answerHeader.textContent = isRandom ? `解答（${headerText}）` : '解答';
        elements.answerBody.innerHTML = problem.answer;
        
        updateStatusButtons(problem.status);
        elements.answerContainer.classList.remove('visible');
        elements.toggleBtn.textContent = '解答を表示';

        if (window.MathJax) {
            MathJax.typesetPromise([elements.body, elements.answerBody, elements.header]).catch(console.error);
        }
        
        updateCounter();
        updateNavButtons();
        updateSlider();
    }
    function updateStatusButtons(status) {
        elements.statusControls.querySelectorAll('.status-btn').forEach(btn => {
            btn.classList.remove('active', 'solved', 'attention');
            if (btn.dataset.status === status) { btn.classList.add('active', status); }
        });
    }
    function updateCounter() {
        elements.counter.textContent = state.filteredProblems.length > 0 ? `${state.currentIndex + 1} / ${state.filteredProblems.length}` : '0 / 0';
    }
    function updateNavButtons() {
        elements.prevBtn.disabled = state.currentIndex === 0;
        elements.nextBtn.disabled = state.currentIndex >= state.filteredProblems.length - 1;
    }
    elements.typeFilters.addEventListener('change', updateProblemList);
    elements.statusFilters.addEventListener('change', updateProblemList);
    elements.statusControls.addEventListener('click', (e) => {
        if (e.target.classList.contains('status-btn')) {
            const newStatus = e.target.dataset.status;
            if (state.filteredProblems.length > 0) {
                const currentProblemId = state.filteredProblems[state.currentIndex].id;
                saveStatus(currentProblemId, newStatus);
                updateStatusButtons(newStatus);
            }
        }
    });
    elements.problemSlider.addEventListener('input', (e) => {
        const newIndex = parseInt(e.target.value, 10);
        if (state.currentIndex !== newIndex) {
            state.currentIndex = newIndex;
            render();
        }
    });
    elements.nextBtn.addEventListener('click', () => { if (state.currentIndex < state.filteredProblems.length - 1) { state.currentIndex++; render(); } });
    elements.prevBtn.addEventListener('click', () => { if (state.currentIndex > 0) { state.currentIndex--; render(); } });
    elements.toggleBtn.addEventListener('click', () => {
        elements.answerContainer.classList.toggle('visible');
        elements.toggleBtn.textContent = elements.answerContainer.classList.contains('visible') ? '解答を隠す' : '解答を表示';
    });
    loadStatus();
    updateProblemList();
});
</script>

</body>
</html>